<% comment ||= Comment.new %>
<%= form_with(model: comment, url: comment.new_record? ? comments_path : comment_path(comment),
              method: comment.new_record? ? "post" : "patch", id: "reply-form-#{comment.id}",
              class: "new-comment-form") do |form| %>
  <%= form.text_area :body, id: "newCommentText", rows: "4", cols: "50", oninput: 'autoResize(this)' %>
  <%= form.hidden_field :post_id, value: (@post.present? ? @post.id : '') %>
  <%= form.hidden_field :comment_id, value: comment.id %>
  <%= form.submit comment.new_record? ? 'Add Comment' : 'Update Comment', class: 'commentitem-button' %>
<% end %>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var editLinks = document.querySelectorAll('.edit-link');
        editLinks.forEach(function (link) {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                var commentId = this.dataset.commentId;
                var form = document.querySelector('#edit-form-' + commentId);
                form.style.display = 'block';
                var textarea = form.querySelector('textarea');
                autoResize(textarea);
            });
        });
    });

    function autoResize(textarea) {
        textarea.style.height = 'auto';
        if (textarea.scrollHeight > textarea.clientHeight) {
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }
    }
</script>